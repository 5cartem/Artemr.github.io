<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>5-Lane Rhythm Game</title>

<style>
  body {
    background: #0e0e1a;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
  }

  #controls {
    margin: 10px;
  }

  #game {
    position: relative;
    width: 500px;
    height: 600px;
    margin: auto;
    display: flex;
    background: #111;
    border: 2px solid #444;
  }

  .lane {
    flex: 1;
    border-left: 1px solid #333;
    position: relative;
    cursor: pointer;
    transition: background 0.1s;
  }

  .lane:first-child {
    border-left: none;
  }

  .lane.active {
    background: rgba(255, 255, 255, 0.15);
  }

  .block {
    position: absolute;
    width: 100%;
    height: 40px;
    top: -40px;
  }

  #hitZone {
    position: absolute;
    bottom: 100px;
    width: 100%;
    height: 60px;
    border-top: 2px solid red;
    border-bottom: 2px solid red;
    pointer-events: none;
  }
</style>
</head>

<body>

<h1>5-Lane Rhythm Game</h1>

<div id="controls">
  Speed:
  <input type="range" id="speed" min="2" max="10" value="5">
  <span id="speedVal">5</span>
</div>

<div id="game">
  <div id="hitZone"></div>
</div>

<p>
  Score: <span id="score">0</span> |
  Misses: <span id="misses">0</span> / 5
</p>

<script>
  const game = document.getElementById("game");
  const scoreEl = document.getElementById("score");
  const missesEl = document.getElementById("misses");
  const speedSlider = document.getElementById("speed");
  const speedVal = document.getElementById("speedVal");

  const lanes = [];
  const colors = ["#ff4d4d", "#4dff4d", "#4dd2ff", "#ff4dff", "#ffd24d"];

  let speed = 5;
  let score = 0;
  let misses = 0;
  let gameOver = false;

  speedSlider.oninput = () => {
    speed = Number(speedSlider.value);
    speedVal.textContent = speed;
  };

  // Create lanes
  for (let i = 0; i < 5; i++) {
    const lane = document.createElement("div");
    lane.className = "lane";
    game.appendChild(lane);
    lanes.push(lane);

    // Mouse
    lane.addEventListener("mousedown", () => {
      lane.classList.add("active");
      handleLaneClick(i);
    });

    lane.addEventListener("mouseup", () => {
      lane.classList.remove("active");
    });

    lane.addEventListener("mouseleave", () => {
      lane.classList.remove("active");
    });

    // Touch
    lane.addEventListener("touchstart", (e) => {
      e.preventDefault();
      lane.classList.add("active");
      handleLaneClick(i);
    });

    lane.addEventListener("touchend", () => {
      lane.classList.remove("active");
    });
  }

  function spawnBlock() {
    if (gameOver) return;

    const laneIndex = Math.floor(Math.random() * 5);
    const block = document.createElement("div");
    block.className = "block";
    block.style.background = colors[laneIndex];
    block.dataset.y = -40;

    lanes[laneIndex].appendChild(block);

    function fall() {
      if (gameOver) return;

      let y = Number(block.dataset.y);
      y += speed;
      block.dataset.y = y;
      block.style.top = y + "px";

      if (y > 600) {
        block.remove();
        registerMiss();
        return;
      }

      requestAnimationFrame(fall);
    }

    requestAnimationFrame(fall);
  }

  function handleLaneClick(laneIndex) {
    if (gameOver) return;

    const block = lanes[laneIndex].querySelector(".block");
    if (!block) {
      registerMiss();
      return;
    }

    const y = Number(block.dataset.y);
    if (y >= 460 && y <= 520) {
      score++;
      scoreEl.textContent = score;
      block.remove();
    } else {
      registerMiss();
    }
  }

  function registerMiss() {
    misses++;
    missesEl.textContent = misses;
    if (misses >= 5) endGame();
  }

  function endGame() {
    gameOver = true;
    alert("Game Over!\nScore: " + score);
  }

  setInterval(spawnBlock, 800);
</script>

</body>
</html>
